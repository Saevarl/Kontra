# Target contract for session_summary transformation
# The agent must produce a DataFrame that passes all these rules

name: session_summary

rules:
  # One row per session
  - name: unique
    params:
      column: session_id

  # All required columns must be present and non-null
  - name: not_null
    params:
      column: session_id

  - name: not_null
    params:
      column: user_id

  - name: not_null
    params:
      column: user_name

  - name: not_null
    params:
      column: user_segment

  - name: not_null
    params:
      column: session_duration_seconds

  - name: not_null
    params:
      column: click_count

  - name: not_null
    params:
      column: purchase_count

  - name: not_null
    params:
      column: total_revenue

  # Duration must be non-negative (catches timezone bug)
  - name: range
    params:
      column: session_duration_seconds
      min: 0

  # Click count must be positive
  - name: range
    params:
      column: click_count
      min: 1

  # Purchase count must be non-negative
  - name: range
    params:
      column: purchase_count
      min: 0

  # Revenue must be non-negative
  - name: range
    params:
      column: total_revenue
      min: 0

  # Should have a reasonable number of sessions
  # With all traps properly handled, expect 400-800 valid sessions
  - name: min_rows
    params:
      threshold: 300

  - name: max_rows
    params:
      threshold: 1000
