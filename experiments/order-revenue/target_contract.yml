# Target contract for customer_summary transformation
# The agent must produce a DataFrame that passes all these rules

name: customer_summary

rules:
  # One row per customer (customers with orders only)
  - name: unique
    params:
      column: customer_id

  # All required columns must be present and non-null
  - name: not_null
    params:
      column: customer_id

  - name: not_null
    params:
      column: customer_name

  - name: not_null
    params:
      column: total_revenue

  - name: not_null
    params:
      column: order_count

  - name: not_null
    params:
      column: last_order_date

  # Revenue must be positive (cancelled orders excluded, NULL prices handled)
  - name: range
    params:
      column: total_revenue
      min: 0

  # Order count must be positive (at least 1 non-cancelled order per customer)
  - name: range
    params:
      column: order_count
      min: 1

  # Should have exactly 24 customers (27 with orders, minus 5 orphan customer_ids,
  # but some customers may share with orphan orders... let's see)
  # Actually: customers 1-27 get orders, customer 99 doesn't exist
  # So we expect rows for customers who have at least one non-cancelled order
  # Let me recalculate...
  # Orders 1-5: customer 99 (orphan, excluded)
  # Orders 6-10: cancelled (but still count as having orders if not cancelled)
  # Orders 6-10 are cancelled, customers 6%27+1=7, 7%27+1=8, etc
  # Actually the logic is: i<5 -> customer 99, else (i%27)+1
  # So orders 5-99 (indices 5-99, order_ids 6-100) go to customers 1-27
  # Orders 0-9 (order_ids 1-10) have status: first 10 are cancelled
  # Wait, order_id 1-5 go to customer 99, order_id 6-10 are the first 5 of the 95 remaining
  # Let me just require a reasonable range and let the agent figure it out
  - name: min_rows
    params:
      threshold: 20  # At least 20 customers with non-cancelled orders

  - name: max_rows
    params:
      threshold: 30  # At most 30 (all customers)
