# Target contract for daily_user_activity transformation
# The agent must produce a DataFrame that passes all these rules

name: daily_user_activity

rules:
  # Unique combination of user and date
  - name: unique
    params:
      column: user_date_key  # Composite key: "{user_id}_{event_date}"

  # All required columns must be present and non-null
  - name: not_null
    params:
      column: user_id

  - name: not_null
    params:
      column: user_name

  - name: not_null
    params:
      column: user_tier

  - name: not_null
    params:
      column: event_date

  - name: not_null
    params:
      column: completed_events

  - name: not_null
    params:
      column: total_amount

  # Completed events must be positive (at least 1 per row)
  - name: range
    params:
      column: completed_events
      min: 1

  # Total amount must be non-negative
  - name: range
    params:
      column: total_amount
      min: 0

  # Should have reasonable number of rows
  # ~45 users with completed events Ã— up to 30 days, but not all users active every day
  # Expect somewhere between 200-600 rows
  - name: min_rows
    params:
      threshold: 100

  - name: max_rows
    params:
      threshold: 800
